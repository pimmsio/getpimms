model Domain {
  id                      String            @id @default(cuid())
  slug                    String            @unique
  verified                Boolean           @default(false)
  placeholder             String?
  expiredUrl              String?           @db.LongText // URL to redirect to for expired links
  notFoundUrl             String?           @db.LongText // URL to redirect to for links that don't exist
  primary                 Boolean           @default(false)
  archived                Boolean           @default(false)
  lastChecked             DateTime          @default(now())
  logo                    String?
  appleAppSiteAssociation Json?
  assetLinks              Json?
  links                   Link[]
  project                 Project?          @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId               String?
  registeredDomain        RegisteredDomain?
  programs                Program[]
  workspaceAccesses       DomainWorkspaceAccess[]

  // these attributes will exist on both Link and Domain models
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index(projectId)
  @@index(lastChecked(sort: Asc))
}

model DomainWorkspaceAccess {
  id              String   @id @default(cuid())
  domainSlug       String
  workspaceId      String
  enabled          Boolean  @default(false)
  requestedByUserId String?
  enabledByUserId   String?
  enabledAt         DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  domain       Domain  @relation(fields: [domainSlug], references: [slug], onDelete: Cascade, onUpdate: Cascade)
  workspace    Project @relation(fields: [workspaceId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([domainSlug, workspaceId])
  @@index([workspaceId])
  @@index([domainSlug])
}

model RegisteredDomain {
  id        String   @id @default(cuid())
  slug      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  expiresAt DateTime

  project   Project @relation(fields: [projectId], references: [id])
  projectId String
  domain    Domain? @relation(fields: [domainId], references: [id], onDelete: SetNull)
  domainId  String? @unique

  @@index(projectId)
  @@index(expiresAt(sort: Asc))
}

model DefaultDomains {
  id          String  @id @default(cuid())
  pimms       Boolean @default(true)
  fcksubcom   Boolean @default(false)
  projectId   String  @unique
  project     Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}
