model Customer {
  id               String  @id @default(cuid())
  name             String?
  email            String?
  avatar           String? @db.Text
  externalId       String?
  stripeCustomerId String? @unique

  linkId             String?
  lastActivityLinkId String?
  // last recorded activity type for this customer: click | lead | sale
  lastActivityType   String?
  clickId            String?
  clickedAt          DateTime?
  country            String?
  anonymousId        String?
  totalClicks        Int       @default(0)
  hotScore           Int       @default(0)
  lastHotScoreAt     DateTime?
  lastEventAt        DateTime?

  projectId        String
  projectConnectId String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  project          Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  link             Link?        @relation("CustomerPrimaryLink", fields: [linkId], references: [id])
  lastActivityLink Link?        @relation("CustomerLastActivityLink", fields: [lastActivityLinkId], references: [id])
  commissions      Commission[]

  @@unique([projectId, externalId])
  @@unique([projectConnectId, externalId])
  @@index(externalId)
  @@index(linkId)
  @@index(lastActivityLinkId)
}
